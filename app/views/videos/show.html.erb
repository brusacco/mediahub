<% content_for :extra_stylesheets do %>
  <style>
    /* Hide scrollbar but keep functionality */
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
<% end %>

<!-- Enhanced Header -->
<header class="bg-white shadow-sm border-b border-gray-200">
  <div class="max-w-full mx-auto px-4 py-6 sm:px-6 lg:px-12 xl:px-16">
    <div class="md:flex md:items-center md:justify-between">
      <div class="flex-1 min-w-0">
        <h1 class="text-3xl font-bold text-gray-900 tracking-tight">
          <i class="fas fa-video text-indigo-500 mr-2" aria-hidden="true"></i>Detalles del Clip
        </h1>
        <p class="mt-1 text-sm text-gray-600">
          <%= @clip.station.name %> - <%= @clip.posted_at.strftime("%d-%m-%Y %H:%M:%S") %>
        </p>
      </div>
      <div class="mt-4 flex flex-col sm:flex-row gap-2 md:mt-0 md:ml-4">
        <a href="<%= @clip_path %>" download data-turbo="false" class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
          <i class="fa-solid fa-download mr-2"></i>
          Descargar Video
        </a>
      </div>
    </div>
  </div>
</header>

<!-- Breadcrumbs -->
<%= render 'shared/breadcrumbs', items: [
  { label: 'Inicio', path: root_path, icon: 'fa-solid fa-home' },
  { label: 'Videos', path: nil },
  { label: @clip.station.name, path: nil, current: true }
] %>

<!-- Main Content -->
<section class="py-8 lg:py-12 bg-gray-50">
  <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-12 xl:px-16">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Video Player - Left Column (2/3 on large screens) -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Video Player Card -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
          <div class="bg-black aspect-video flex items-center justify-center">
            <video class="w-full h-full" controls poster="<%= "/#{@clip.thumbnail_path}" if @clip.thumbnail_path.present? %>">
              <source src="<%= @clip_path %>" type="video/mp4">
              Tu navegador no soporta el elemento de video.
            </video>
          </div>
          <div class="p-6">
            <div class="flex items-center gap-6 text-sm text-gray-600">
              <div class="flex items-center gap-2">
                <i class="fa-regular fa-calendar"></i>
                <span><%= @clip.posted_at.strftime("%d-%m-%Y %H:%M:%S") %></span>
              </div>
              <div class="flex items-center gap-2">
                <i class="fa-solid fa-tv"></i>
                <span><%= @clip.station.name %></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Film Strip: Timeline - Full Width -->
        <% if @related_videos.any? && @related_videos.length > 1 %>
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 lg:p-8" data-controller="film-strip">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <i class="fa-solid fa-clock-rotate-left text-indigo-600"></i>
              Línea del Tiempo
            </h3>
            <div class="relative w-full">
              <!-- Film Strip Container -->
              <div data-film-strip-target="container" class="flex items-center gap-3 overflow-x-auto pb-4 scrollbar-hide w-full" style="scroll-behavior: smooth;">
                <% @related_videos.each_with_index do |video, index| %>
                  <% 
                    is_current = video.id == @clip.id
                    video_path = "/#{video.public_path}"
                    thumbnail_path = video.thumbnail_path.present? ? "/#{video.thumbnail_path}" : nil
                  %>
                  <div <%= 'data-film-strip-target="current"' if is_current %> class="flex-shrink-0 <%= is_current ? 'w-72' : 'w-32' %> transition-all duration-300 <%= is_current ? 'scale-105' : 'opacity-70 hover:opacity-100' %>">
                    <%= link_to video_path(video), class: "block w-full", data: { turbo: false } do %>
                      <div class="bg-gray-900 rounded-lg overflow-hidden shadow-lg <%= is_current ? 'ring-4 ring-indigo-500' : 'ring-2 ring-gray-300' %> w-full">
                        <!-- Thumbnail -->
                        <div class="aspect-video relative w-full">
                          <% if thumbnail_path %>
                            <%= image_tag thumbnail_path, alt: video.station.name, class: "w-full h-full object-cover" %>
                          <% else %>
                            <div class="w-full h-full bg-gray-800 flex items-center justify-center">
                              <i class="fa-solid fa-video text-gray-600 text-2xl"></i>
                            </div>
                          <% end %>
                          <!-- Play Overlay -->
                          <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center">
                            <i class="fa-solid fa-play-circle text-white text-3xl opacity-0 hover:opacity-100 transition-opacity"></i>
                          </div>
                          <!-- Current Video Badge -->
                          <% if is_current %>
                            <div class="absolute top-2 right-2 bg-indigo-600 text-white text-xs font-bold px-2 py-1 rounded">
                              Actual
                            </div>
                          <% end %>
                        </div>
                        <!-- Video Info -->
                        <div class="p-3 bg-gray-900">
                          <p class="text-white text-xs font-medium truncate">
                            <%= video.station.name %>
                          </p>
                          <p class="text-gray-400 text-xs mt-1">
                            <%= video.posted_at.strftime("%d/%m/%Y %H:%M") %>
                          </p>
                        </div>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>

      </div>

      <!-- Sidebar - Right Column (1/3 on large screens) -->
      <div class="lg:col-span-1 space-y-6">
        <!-- Metadata Card -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Información</h3>
          <dl class="space-y-4">
            <div>
              <dt class="text-sm font-medium text-gray-500 mb-1">Fecha</dt>
              <dd class="text-sm text-gray-900">
                <%= @clip.posted_at.strftime("%d-%m-%Y %H:%M:%S") %>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500 mb-1">Estación</dt>
              <dd class="text-sm text-gray-900">
                <%= @clip.station.name %>
              </dd>
            </div>
          </dl>
        </div>

        <!-- Transcription Card -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <i class="fa-solid fa-file-text text-indigo-600"></i>
            Transcripción
          </h3>
          <div class="prose prose-sm max-w-none">
            <p class="text-gray-700 leading-relaxed text-sm">
              <% if @clip.tag_list.present? %>
                <%= highlight(@clip.transcription, @clip.all_tags_boundarys) -%>
              <% else %>
                <%= @clip.transcription %>
              <% end %>
            </p>
          </div>
        </div>

        <!-- Tags Card -->
        <% if @clip.tags.any? %>
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <i class="fa-solid fa-tags text-indigo-600"></i>
              Etiquetas
            </h3>
            <div class="flex flex-wrap gap-2">
              <% @clip.tags.each do |tag| %>
                <%= link_to tag_path(tag), class: "inline-flex items-center rounded-md bg-indigo-50 px-3 py-1 text-sm font-medium text-indigo-700 ring-1 ring-inset ring-indigo-700/10 hover:bg-indigo-100 transition-colors" do %>
                  <%= tag.name %>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</section>
